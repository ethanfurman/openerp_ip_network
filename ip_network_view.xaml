!!! coding: utf-8
!!! xml1.0

-view = 'ir.ui.view'
-action = 'ir.actions.act_window'
-network = 'ip_network.network'
-device = 'ip_network.device'
-device_script = 'ip_network.device.script'
-device_type = 'ip_network.device.type'
-field = 'ip_network.extra.field'
-command = 'ip_network.extra.command'
-apm_user = 'group_ip_network'

~openerp
    ~data

        // menus

        ~menuitem name='Information Technology' #menu_ip_network_it groups=apm_user parent='base.menu_reporting'

        ~menuitem @Network #menu_ip_network groups=apm_user parent='menu_ip_network_it'

        ~menuitem @Configuration #menu_ip_network_conf parent='menu_ip_network_it' sequence='90'


        // networks

        ~record model=view #view_ip_network_tree
            @name: ip_network.network.tree
            @model: = network
            @arch type='xml'
                ~tree $IP_Map_Networks
                    @name
                    @network

        ~record model=view #view_ip_network_form
            @name: ip_network.network.form
            @model: = network
            @arch type='xml'
                ~form $IP_Map_Networks version='7.0'
                    ~group
                        ~group
                            @name
                            @network
                        ~group
                            @description

        ~record model=action #action_ip_network
            @name: IP Networks
            @res_model: = network
            @view_type: form
            @view_id ref='view_ip_network_tree'
            @view_mode: tree,form

        ~menuitem @Networks #menu_ip_network_network parent='menu_ip_network' action='action_ip_network'


        // devices

        ~record model=view #view_ip_network_device_tree
            @name: ip_network.device.tree
            @model: = device
            @arch type='xml'
                ~tree $IP_Map_Devices
                    @ip_addr
                    @name
                    @type_id
                    @status

        ~record model=view #view_ip_network_device_form
            @name: ip_network.device.form
            @model: = device
            @arch type='xml'
                ~form $IP_Map_Devices version='7.0'
                    ~group
                        ~group
                            @name
                            @ip_addr
                            @type_id
                            @last_comms
                        ~group
                            @image_small widget='image' class='oe_image oe_right' nolabel='1' attrs="{'readonly':True}"
                            ~div
                                ~button $Refresh @update_status type='object'
                                @status attrs="{'readonly':True}"
                                @clues attrs="{'readonly':True}"
                    ~group @short_fields
                    ~notebook @notebook_fields
                        ~page $WS_Scripts
                            @ws_scripts mode='kanban' context="{'target_ip': ip_addr}"
                        ~page $Misc_Files @misc_files
                            @device_files
                        ~page $Errors
                            @errors

        ~record model=view #view_ip_network_device_kanban
            @name: ip_network.device.kanban
            @model: = device
            @arch type='xml'
                ~kanban version='7.0' .oe_background_grey create='false'
                    @status
                    @ip_addr
                    @image_small
                    ~templates
                        ~t t-name='kanban-box' t-attf-class='base #{cls}'
                            ~div .oe_kanban_global_click style='border-style: solid'
                                ~a type='open'
                                    ~img t-att-src="kanban_image('ip_network.device', 'image_small', record.id.value )" .oe_avatar .oe_kanban_avatar_smallbox
                                ~div .oe_module_desc
                                    ~div .oe_kanban_box_content
                                        ~table .oe_kanban_table
                                            ~tr
                                                ~td .oe_kanban_title1
                                                    ~h4
                                                        @ip_addr
                                                ~td
                                                    ~b
                                                        @name .oe_oneline
                                            ~tr
                                                ~td
                                                    @type_id
                                            ~tr
                                                ~td
                                                    ~div
                                                        @last_comms
                                                    ~div
                                                        @clues
                                ~button type='object' @update_status .oe_avatar .oe_kanban_avatar_smallbox
                                    ~img src='/web/static/src/img/icons/gtk-refresh.png'

        ~record model=action #action_ip_network_device
            @name: IP Devices
            @res_model: = device
            @view_type: form
            @view_id ref='view_ip_network_device_tree'
            @view_mode: tree,form,kanban,
            @limit: 4096

        ~menuitem @Devices #menu_ip_network_device parent='menu_ip_network' action='action_ip_network_device' sequence='10'


        // remote scripts

        ~record model=view #view_ip_network_device_script_form
            @name: ip_network.device.script.form
            @model: = device_script
            @arch type='xml'
                ~form $device_script version='7.0' setup='onload()'
                    ~group
                        ~group
                            @name
                            @filename
                            ~separator colspan='2'
                            @run_by_user
                            @run_as_user
                        ~group
                            @active
                    ~label for='script' $Script
                    @script nolabel='1'

        ~record model=view #view_ip_network_device_script_kanban
            @name: ip_network.device.script.kanban
            @model: = device_script
            @arch type='xml'
                ~kanban version='7.0' .oe_background_grey
                    @active
                    @name
                    @filename
                    @shebang
                    @run_by_user
                    @run_as_user
                    ~templates
                        ~t t-name='kanban-box' t-attf-class='base #{cls}'
                            ~div style='border-style: solid'
                                ~img t-att-src="kanban_image('ip_network.device.script', 'image_small', record.id.value )" .oe_avatar .oe_kanban_avatar_mediumbox
                                ~div .oe_module_desc
                                    ~div .oe_kanban_box_content
                                        ~table .oe_kanban_table
                                            ~tr
                                                ~td .oe_kanban_title1
                                                    ~a type='open'
                                                        ~h4
                                                            @name
                                            ~tr
                                                ~td
                                                    @filename
                                                ~td
                                                    ~div t-if='record.run_by_user.raw_value': Run by:
                                                        ~i: ~b: User
                                                    ~div t-if='!record.run_by_user.raw_value': Run by:
                                                        ~i: ~b: Admin
                                            ~tr
                                                ~td
                                                    @shebang
                                                ~td
                                                    ~div t-if='record.run_as_user.raw_value': Run as:
                                                        ~i: ~b: user
                                                    ~div t-if='!record.run_as_user.raw_value': Run as:
                                                        ~i: ~b: root
                                            ~tr
                                                ~td
                                                ~td t-if='record.active.raw_value'
                                                    ~button type='object' @run_script .oe_avatar .oe_right
                                                        Run

        ~record model=action #action_ip_network_device_script
            @name: Remote Scripts
            @res_model: = device_script
            @view_type: form
            @view_id ref='view_ip_network_device_script_kanban'
            @view_mode: kanban,form
            @limit: 4096

        ~menuitem name='Remote Scripts' #menu_ip_network_device_script parent='menu_ip_network_conf' action='action_ip_network_device_script' sequence='50'


        // device types

        ~record model=view #view_ip_network_device_type_tree
            @name: ip_network.device.type.tree
            @model: = device_type
            @arch type='xml'
                ~tree $Device_Types
                    @name
                    @test
                    @short_name
                    @sequence invisible='1'

        ~record model=view #view_ip_network_device_type_form
            @name: ip_network.device.type.form
            @model: = device_type
            @arch type='xml'
                ~form $Device_Types version='7.0'
                    ~group
                        ~group
                            @name
                            @test
                        ~group
                            @short_name
                    ~label for='description' $Description
                    @description nolabel='1'

        ~record model=action #action_ip_network_device_type
            @name: IP Device Types
            @res_model: = device_type
            @view_type: form
            @view_id ref='view_ip_network_device_type_tree'
            @view_mode: tree,form

        ~menuitem @Types #menu_ip_network_conf_device_type parent='menu_ip_network_conf' action='action_ip_network_device_type' sequence='10'


        // commands

        ~record model=view #view_ip_network_command_tree
            @name: ip_network.extra.command.tree
            @model: = command
            @arch type='xml'
                ~tree $IP_Map_Commands
                    @name
                    @where
                    @sequence
                    @active

        ~record model=view #view_ip_network_command_form
            @name: ip_network.extra.command.form
            @model: = command
            @arch type='xml'
                ~form $IP_Map_Commands version='7.0'
                    ~group
                        ~group
                            @id invisible='1'
                            @active
                            @name attrs="{'readonly':[('id','!=',False)]}"
                            @where
                            @field_ids
                                ~tree
                                    @name
                                    @string
                                    @type
                                    @size attrs="{'invisible':[('type','!=','char')]}"
                        ~group
                            @sequence
                            @run_for_ids
                    ~separator
                    ~group
                        @description
                    ~separator
                    ~group
                        @command $Command attrs="{'invisible':[('where','=','user')]}" .oe_monospace
                        ~label for='script' $Python_Script attrs="{'invisible':[('where','=','user')]}"
                        @script nolabel='1' attrs="{'invisible':[('where','=','user')]}" .oe_monospace

        ~record model=action #action_ip_network_command
            @name: IP Field Commands
            @res_model: = command
            @view_type: form
            @view_id ref='view_ip_network_command_tree'
            @view_mode: tree,form
            @domain: ['|',('active','=',True),('active','=',False)]

        ~menuitem @Commands #menu_ip_network_conf_command parent='menu_ip_network_conf' action='action_ip_network_command' sequence='20'


        // fields

        ~record model=view #view_ip_network_extra_field_tree
            @name: ip_network.extra.field.tree
            @model: = field
            @arch type='xml'
                ~tree $Fields edit='0' create='0' delete='0'
                    @name
                    @string
                    @type
                    @size attrs="{'invisible':[('type','!=','char')]}"
                    @command_run_for_ids

        ~record model=view #view_ip_network_extra_field_form
            @name: ip_network.extra.field.form
            @model: = field
            @arch type='xml'
                ~form $Fields edit='0' create='0' delete='0' version='7.0'
                    ~group
                        ~group
                            @name
                            @type
                            @size attrs="{'invisible':[('type','!=','char')]}"
                        ~group
                            @string
                            @notes

        ~record model=action #action_ip_network_field
            @name: Device Fields
            @res_model: = field
            @view_type: form
            @view_id ref='view_ip_network_extra_field_tree'
            @view_mode: tree,form

        ~menuitem @Fields #menu_ip_network_conf_field parent='menu_ip_network_conf' action='action_ip_network_field' sequence='30'

        // this pc

        ~record model=action #action_ip_network_device_self
            @name: This PC
            @res_model: = device
            @view_type: form
            @view_id ref='view_ip_network_device_kanban'
            @view_mode: kanban,form
            @domain: [('ip_addr','=','THIS_PC')]
            @help type='html'
                ~p .oe_view_nocontent
                    This PC is not being tracked.

        ~menuitem name='This PC' #menu_ip_network_device_self parent='mail.messaging_miscellany' action='action_ip_network_device_self' sequence='10'

    ~data noupdate='1'

        // dynamic view

        ~record model=view #view_ip_network_device_dynamic_form
            @name: ip_network.device.dynamic.form
            @model: = device
            @inherit_id ref='view_ip_network_device_form'
            @arch type='xml'
                ~group @short_fields position='inside'
                    temp text
